<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>

  
	<title>NewOrder - news: Reverse Engineering with LD_PRELOAD</title>
	 
	<meta content="text/html; charset=UTF-8" http-equiv="content-type">
	<meta name="description" content="Computer security and networking portal">
	<meta name="keywords" content="security,exploits,forums,artcles,sms news,links, ">

	<link rel="Shortcut Icon" href="http://neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">
	<link rel="SHORTCUT ICON" href="http://neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="http://neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">

	<link rel="Icon" href="http://neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="hijack%20Files/style.css" type="text/css">
	<link rel="stylesheet" href="hijack%20Files/layout.css" type="text/css">
	<link rel="stylesheet" href="hijack%20Files/menu.css" type="text/css">
	<!--[if IE]>
                <style type="text/css" media="screen">
                        #menu{ float:right; }
                        body{
                                behavior:url(/tools/csshover.htc);
                                font-size:100%;
                        }
                        #menu ul li{
                                float: right;
                                width: 100%;
                        }
                        #menu h2, #menu a{
                                height:1%;
                                /*font:bold 0.7em/1.4em arial,helvetica,sans-serif;*/
                        }
                </style>
<![endif]-->

	<script language="JavaScript" type="text/javascript" src="hijack%20Files/functions.js"></script>
	<script language="JavaScript" type="text/javascript" src="hijack%20Files/scroller.js"></script>
</head><body leftmargin="0" topmargin="0" alink="#88cc99" background="" bgcolor="black" text="#eeeeee" vlink="#66bb77" link="#88cc99" marginheight="0" marginwidth="0">
<a name="top"></a>
<script language="JavaScript" type="text/javascript">
var barbgcolor='black';
var fosize='12';
var bagcolor='black';
var focolor='white';
var mebagcolor='black';
var mefocolor='white';
</script> 
<div id="header">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tbody><tr>
                <td colspan="3" rowspan="1">
                        <script language="JavaScript" src="hijack%20Files/linkbar.js" type="text/javascript"></script><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><form name="linky">
<div style="border: 0px solid black; padding: 0pt; width: 100%; height: 20px; background-color: black;">
<div style="background: black none repeat scroll 0% 0%; float: left; height: 20px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<a target="_blank" href="http://www.box.sk/"><img src="hijack%20Files/box.gif" border="0" width="73" height="20"></a></div><div style="float: left;">
 <font style="font-family: arial,helvetica; color: white;"> <select style="background: black none repeat scroll 0% 0%; width: 230px; font-size: 11px; color: white; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;" name="streams" onchange="change(this.options[this.selectedIndex].value)">
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">select a site
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">internet &amp; computers
</option>
<option style="color: white;" value="http://astalavista.box.sk">    Astalavista :: search engine
</option>
<option style="color: white;" value="http://neworder.box.sk">    NewOrder :: comp. security portal
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">operating systems
</option>
<option style="color: white;" value="http://linux.box.sk">    Linux
</option>
<option style="color: white;" value="http://easy.box.sk">    Windows
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">development
</option>
<option style="color: white;" value="http://code.box.sk">    Code :: development portal
</option>
<option style="color: white;" value="http://edge.dev.box.sk">    Edge :: community engine
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">multimedia &amp; games
</option>
<option style="color: white;" value="http://dvd.box.sk">    DVD
</option>
<option style="color: white;" value="http://mp3.box.sk">    MP3 :: mp3 &amp; music portal
</option>
<option style="color: white;" value="http://www.ggmania.com">    GG mania :: computer games
</option>
<option style="color: white;" value="http://eye.box.sk">    Eye :: computer graphics
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">technology &amp; science
</option>
<option style="color: white;" value="http://science.box.sk">    Science :: daily news &amp; forums
</option>
<option style="color: white;" value="http://mobile.box.sk">    Mobile :: downloads &amp; tips
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">world &amp; leisure
</option>
<option style="color: white;" value="http://travel.box.sk">    Travel :: articles &amp; guides
</option>
<option style="color: white;" value="http://photo.box.sk">    Photo :: galleries &amp; articles
</option>
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">communities around box
</option>
<option style="color: white;" value="http://juice.box.sk">    Juice :: online community
</option>
<option style="color: white;" value="http://www.cassovia.sk">    Cassovia :: the city project
</option>
<option style="color: white;" value="http://titles.box.sk">    Titles: divx subtitles
</option>
<option style="color: white;" value="http://covers.box.sk">    Covers: dvd covers
</option>
</select>
</font></div><div style="float: left;"><font style="font-family: arial,helvetica; color: white;"> 
<select style="background: black none repeat scroll 0% 0%; width: 200px; font-family: arial,helvetica; font-size: 11px; color: white; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;" name="boards" onchange="change(this.options[this.selectedIndex].value)">
<option style="background: black none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: white;" value="">forums
</option><option style="color: white;" value="http://neworder.box.sk/forumm.php">    New Order computer security
</option><option style="color: white;" value="http://dvd.box.sk/boardm.php">    DVD related board
</option><option style="color: white;" value="http://mp3.box.sk/boardm.php">    MP3 board
</option><option style="color: white;" value="http://www.ggmania.com/forum/">    Computer games board
</option><option style="color: white;" value="http://science.box.sk/forumm.php">    Science board
</option><option style="color: white;" value="http://code.box.sk/boardm.php">    Coding related boards
</option><option style="color: white;" value="http://edge.dev.box.sk/forumm.php">    Edge engine development board
</option><option style="color: white;" value="http://linux.box.sk/forumm.php">    Linux boards
</option></select></font></div>
<div id="ref" style="float: left; top: 10px; width: 270px; height: 20px; background-color: black;"><div id="outer" style="overflow: hidden; width: 270px; height: 20px; visibility: visible; background-color: black; left: 0px; top: 2px;"><div id="inner" style="overflow: hidden; visibility: visible; left: 0px; top: 20px; width: 270px; cursor: default; clip: rect(0px, 640px, 0px, 0px);"> <font style="font-family: arial,helvetica; font-size: 12px; color: white;">story: <a href="http://story.box.sk//newsread.php?newsid=106">Medzev: The hamor (forge) and the...</a></font></div></div></div></div></form></td></tr></tbody></table>
                </td>
        </tr>
        <tr>
                <td rowspan="2" colspan="1" width="10"> </td>
                <td rowspan="1" colspan="1" width="193">
                        <a href="http://neworder.box.sk/"><img src="hijack%20Files/neworder.jpg" alt="Triangle Logo" border="0"></a>
                </td>
                <td rowspan="1" colspan="1" align="right">
                        <a style="color: white;" target="_blank" href="http://www.gfi.com/adentry.asp?adv=143&amp;loc=12">
		<img alt="Banner" src="hijack%20Files/LANSS_Vul_Backdoor468x60.gif" border="0"><br>
		<font style="color: white;" size="-2" face="arial">Scan for and remediate security vulnerabilities -  Download free 30-day trial!</font></a><font style="color: white;" size="-2" face="arial"></font>                </td>
        </tr>
	<tr>
		<td rowspan="1" colspan="1" width="193">
			<p></p><p>
</p><form name="myform" method="post">	

<script language="JavaScript">
function OnSSL()
{
  document.myform.action ="https://neworder.box.sk/index.php";
  document.myform.sumbit();
}
function OnNormal()
{
 document.myform.action ="http://neworder.box.sk/index.php";	
 document.myform.submit();
}
</script>

<table border="0" cellpadding="3" cellspacing="0">
<tbody><tr>
<td class="edgenormal" bgcolor="#114422">login:</td><td class="edgenormal" bgcolor="#114422"> 
<input maxlength="32" size="8" name="ulogin" class="submitinput" value="" type="text"></td>
</tr>
<tr>
<td class="edgenormal" bgcolor="#114422">password:</td><td class="edgenormal" bgcolor="#114422"> 
	<input maxlength="32" size="8" class="submitinput" name="upassword" type="password"></td>
</tr>
<tr>
<td colspan="2" align="right" bgcolor="#114422">
<input class="submitinput" value="Login" onclick="javascript:OnNormal()" type="submit">
<input class="submitinput" value="SSL" onclick="javascript:OnSSL()" type="submit">
</td>
</tr>
</tbody></table>


</form>
                </td>
		<td> </td>
	</tr>
</tbody></table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tbody><tr>
		<td align="right">
<div id="menu">
	<ul>
		<li>
			<h2><a href="http://neworder.box.sk/">Main</a></h2>
			<ul>
				<li><a href="http://neworder.box.sk/">Articles</a></li>
				<li><a href="http://neworder.box.sk/exploits">Exploits</a></li>
				<li><a href="http://neworder.box.sk/links">Links</a></li>
				<li><a href="http://neworder.box.sk/projects">Projects</a></li>
			</ul>
		</li>
	</ul>
	<ul>
		<li>
			<h2><a href="http://neworder.box.sk/forums">Forums</a></h2>
			<ul>
				<li><a href="http://neworder.box.sk/forums">Overview</a></li>
                                <li><a href="http://neworder.box.sk/rfp">Hot Topics</a></li>
			</ul>
		</li>
	</ul>
	<ul>
		<li>
			<h2><a href="http://neworder.box.sk/vault">The Vault</a></h2>
		</li>
	</ul>
	<ul>
                <li>
                        <h2><a href="http://neworder.box.sk/">Misc</a></h2>
			<ul>
				<li><a href="http://neworder.box.sk/wallpapers.php">Wallpapers</a></li>
				<li><a href="http://neworder.box.sk/gal_arch.php">Gallery</a></li>
				<li><a href="http://neworder.box.sk/faq">FaQ</a></li>
				<li><a href="http://neworder.box.sk/staff">Staff</a></li>
				<li><a href="http://neworder.box.sk/nl">Newsletter</a></li>
			</ul>
                </li>
        </ul>
	<ul>
                <li>
                        <h2><a href="http://neworder.box.sk/register">Register</a></h2>
                </li>
        </ul>
</div>
	</td></tr>
        <tr>
	        <td class="edgedotitle2" align="right">
        	<br>           	</td>
        </tr>
</tbody></table>

</div>
<div id="body">
<table border="0" cellpadding="3" cellspacing="3" width="100%">
	<tbody><tr><td align="left" valign="top" width="200">
	<div id="edgedotitle">features</div><p class="edgebig"><b><a href="http://neworder.box.sk/post">post news</a></b></p><br>
		<span class="edgesmall">(SMS/Articles)</span><p><font size="-2" face="verdana,arial,helvetica">
</font></p><form method="get" action="/search.php">
<font size="-2" face="verdana,arial,helvetica">search files, exploits &amp; links sections:<br>
<input size="10" name="srch" class="selectinput" type="text"><input value="search" class="submitinput" type="submit">
</font><p><font size="-2" face="verdana,arial,helvetica"> 

 
</font>

 </p><form action="/subject.php" method="get"><select name="subject" class="selectinput" onchange='location="/subject.php?subject="+this.options[this.selectedIndex].value;'><option value="SELECTED">Article Themes</option><option value="Articles">Articles</option><option value="Articles -&gt; Encryption">Articles -&gt; Encryption</option><option value="Articles -&gt; Hardware">Articles -&gt; Hardware</option><option value="Articles -&gt; History">Articles -&gt; History</option><option value="Articles -&gt; Networking">Articles -&gt; Networking</option><option value="Articles -&gt; Programming">Articles -&gt; Programming</option><option value="Articles -&gt; Security">Articles -&gt; Security</option><option value="Articles -&gt; Software">Articles -&gt; Software</option><option value="Boxster's Lifestyle">Boxster's Lifestyle</option><option value="HOW-TO -&gt; *nix">HOW-TO -&gt; *nix</option><option value="HOW-TO -&gt; Hardware">HOW-TO -&gt; Hardware</option><option value="HOW-TO -&gt; Networking">HOW-TO -&gt; Networking</option><option value="HOW-TO -&gt; Programming">HOW-TO -&gt; Programming</option><option value="HOW-TO -&gt; Windows">HOW-TO -&gt; Windows</option><option value="Interviews">Interviews</option><option value="New Order Newsletter">New Order Newsletter</option><option value="Out of the box">Out of the box</option><option value="Reviews -&gt; Books">Reviews -&gt; Books</option><option value="Reviews -&gt; Hardware">Reviews -&gt; Hardware</option><option value="Reviews -&gt; Software">Reviews -&gt; Software</option><option value="SMS">SMS</option><option value="Site News">Site News</option><option value="Theme of the month">Theme of the month</option><option value="Views">Views</option></select></form><p> 
</p><div id="edgedotitle">logged users</div><p class="edgesmall">
active for last 5 minutes<br><br>Neworder Staff<br><a href="http://neworder.box.sk/user.php?name=login">login</a> <a href="http://neworder.box.sk/memo.send.php?to=login"><img src="hijack%20Files/mail.gif" border="0" width="13" height="9"></a> <br></p><p class="edgesmall">registered users: 14005 <br><br><span class="edgesmall">There are currently 0 registered users and 31 guests browsing the website.</span></p><p>

</p><div id="edgedotitle">online chat</div> <b>server:</b><br>
                           irc.xor.cx<br>
                         <b>channel:</b><br>
                           #neworder<p></p><div id="edgedotitle">Latest SMS headlines</div>
<script language="javascript" type="text/javascript">
var scrollercontent=new Array();scrollercontent[0]='<a href="/smsread.php?newsid=17431">Covert BT Phorm Trial Report Leaked</a>';scrollercontent[1]='<a href="/smsread.php?newsid=17430">German government approves plod-spyware law</a>';scrollercontent[2]='<a href="/smsread.php?newsid=17428">New report identifies dangerous Web domains</a>';scrollercontent[3]='<a href="/smsread.php?newsid=17427">EU security agency warns over insecure printing</a>';scrollercontent[4]='<a href="/smsread.php?newsid=17426">Hacker demos Symbian security switch off</a>';scrollercontent[5]='<a href="/smsread.php?newsid=17425">Security bug in HP support app aids hackers</a>';scrollercontent[6]='<a href="/smsread.php?newsid=17423">Cybercrooks plant phishing scam on crime reduction website</a>';scrollercontent[7]='<a href="/smsread.php?newsid=17422">Google\'s Android Phone Makes Waves</a>';scrollercontent[8]='<a href="/smsread.php?newsid=17421">Analysts, sci-fi authors challenge security pros to rethink the status quo</a>';scrollercontent[9]='<a href="/smsread.php?newsid=17420">New Design Enables More Cost-effective Quantum Key Distribution</a>';scrollercontent[10]='<a href="/smsread.php?newsid=17419">Secret messages could be hidden in net phone calls</a>';scrollercontent[11]='<a href="/smsread.php?newsid=17416">Bank loses tapes with data on 4.5M clients</a>';scrollercontent[12]='<a href="/smsread.php?newsid=17414">Microsoft urges Windows users to shun \'carpet bombing\' Safari</a>';scrollercontent[13]='<a href="/smsread.php?newsid=17413">A Modular Security Analysis Of The TLS Handshake Protocol</a>';scrollercontent[14]='<a href="/smsread.php?newsid=17412">How To Make Microwaves On A Chip To Replace X-rays For Medical Imaging And Security</a>';scrollercontent[15]='<a href="/smsread.php?newsid=17411">Network Measurement Tool Detect Reset Packets</a>';scrollercontent[16]='<a href="/smsread.php?newsid=17410">Old Windows exploits dominate hack attack traffic</a>';scrollercontent[17]='<a href="/smsread.php?newsid=17409">Potty-mouthed hackers steal comcast.net keys, go for a spin</a>';scrollercontent[18]='<a href="/smsread.php?newsid=17408">Hackers start poking holes in NFC</a>';scrollercontent[19]='<a href="/smsread.php?newsid=17406">Adobe Flash Zero-Day Exploit</a>';
new pausescroller(scrollercontent, "scroller", "", 4000)
</script><div id="scroller" class="" style="overflow: hidden; position: relative;"><div class="innerDiv" style="position: absolute; width: 250px; top: 48px;" id="scroller1"><a href="http://neworder.box.sk/smsread.php?newsid=17431">Covert BT Phorm Trial Report Leaked</a></div><div class="innerDiv" style="position: absolute; width: 250px; visibility: visible; top: 3px;" id="scroller2"><a href="http://neworder.box.sk/smsread.php?newsid=17430">German government approves plod-spyware law</a></div></div>
<div id="edgedotitle">random article</div><table border="0" width="100%"><tbody><tr><td colspan="2" class="edgesmall"><a href="http://neworder.box.sk/news/5414">Software Paradise</a></td></tr><tr><td class="edgesmall" align="left">Cooline</td><td class="edgesmall" align="right">Jul 7 2002</td></tr></tbody></table><br><div id="edgedotitle">quotable quotes</div><span class="edgesmall">Don't wanna have trouble being a hacker,then don't tell people you are. Act dumb...follow the masses <div align="right"><i></i></div></span><br><p></p><div id="edgedotitle">NO image gallery</div><table border="0" cellpadding="2" cellspacing="2" width="100%"><tbody><tr><td bgcolor="#002211"><span class="edgesmall">May 25, 2008</span><br><a href='javascript:otvor("/gal_open.php?id=4624",814,830)'><img src="hijack%20Files/00004624.jpg" border="0"></a><p class="edgesmall"><b>hackersbomb.jpg</b> / <a href="http://neworder.box.sk/gal_arch.php?cat=other%20stuff">other stuff</a><br>click on the picture 
to enlarge and see description</p><p></p><p class="edgemenu"><a href="http://neworder.box.sk/forum.php?did=gale4624">read</a> (5) / <a href="http://neworder.box.sk/forum.newtopic.php?did=gale4624">write</a> comment</p><p class="edgemenu"><select name="gal_arch" class="selectinput" onchange='location="/gal_arch.php?cat="+this.options[this.selectedIndex].value'><option vlaue="">view archive (526)</option><option value="">General (18)</option><option value="mods">mods (40)</option><option value="computers%20and%20networks">computers and networks (110)</option><option value="other%20stuff">other stuff (146)</option><option value="user%20setups">user setups (175)</option><option value="merry%20pranksters">merry pranksters (37)</option></select></p><p class="edgemenu"><a href="http://neworder.box.sk/gal_upload.php">submit a picture to the gallery</a></p></td></tr></tbody></table>    </form></td>
 <td align="left" valign="top">
 <font size="-1" face="arial,helvetica">   

<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tbody><tr><td bgcolor="">
	<table border="0" cellpadding="4" cellspacing="0" width="100%"><tbody><tr>
	<td class="edgenormal" bgcolor="#114422"><span class="edgeatitle">Reverse Engineering with LD_PRELOAD</span><br>
	<span class="edgeasubj"><a href="http://neworder.box.sk/subject.php?subject=Articles%20-%3E%20Security">@ Articles -&gt; Security</a></span>    
	<span class="edgeadate">Jul 11 2005, 13:56 (UTC+0) </span></td></tr><tr><td bgcolor="#002211"><table align="right" border="0" cellpadding="0" cellspacing="0" width="190">
		<tbody><tr><td align="center" bgcolor="#002211" valign="top"><a href='javascript:otvor("/gal_open.php?id=3244",614,413)'><img src="hijack%20Files/00003244.jpg" border="0"></a><br></td></tr></tbody></table><span class="edgeatext"><a href="http://neworder.box.sk/user/izik">izik</a> writes: </span><span class="edgeatext"><br>  This paper is about the LD_PRELOAD feature, and how it can be useful for reverse engineering dynamically linked executables.<br>  This technique allows you to hijack functions/inject code and manipulate the application flow.<br>  <br>  Compiling Methods<br>  -----------------<br>  <br>
Generally there are two ways of producing an executable. The first
method is the static compilation. During the compilation process the <br>
executable that will be produced, will be independent and will include
all it needs to function properly. The advantage of this method<br> is
mainly portability as the user is not required to install anything in
order to use the application. The disadvantage is a relatively
oversized <br> executable, also bugs that originate from an outside
component will not be fixed, since the executable is not linked. The
other method is <br> the dynamically produced executable. It is
dependent on shared libraries to function, and corresponding to changes
in the shared libraries.<br> For better or worse, this can be an
advantage and a disadvantage. Dynamically linked executables by their
nature are more lightweight than <br>   the static produced executables.<br>  <br>   The gcc compiler will by default produce a dynamically linked executable, unless you specify the '-static' parameter to gcc.<br>  <br>   You can browse through the dynamically linked executable dependencies list, using the ldd utility. Following this:<br>  <br>    root@magicbox:~# ldd /bin/ls<br>            linux-gate.so.1 =&gt;  (0xffffe000)<br>            librt.so.1 =&gt; /lib/tls/librt.so.1 (0xb7fd7000)<br>            libc.so.6 =&gt; /lib/tls/libc.so.6 (0xb7eba000)<br>            libpthread.so.0 =&gt; /lib/tls/libpthread.so.0 (0xb7ea8000)<br>            /lib/ld-linux.so.2 (0xb7feb000)<br>    root@magicbox:~#<br>   <br>
Each dependency presenting the library it depends on, while the adress
we see, is the one it would be mapped to during runtime.<br>   This article revolves around dynamically linked executables as they can be manipulated by the LD_PRELOAD.<br>  <br>  Runtime Linker<br>  --------------<br>  <br>
Runtime linker's purpose is to bind the dynamically linked executables
to its dependencies by all means. Taking care of resolving the<br>
symbols and invoking the initialization functions of shared libraries
as well as the finalization functions, if any. It also provides a<br>
set of functions to allow an application to load and unload libraries
at runtime. This is often refereed to as Application Plug-in feature.<br>  <br>
LD_PRELOAD is an environment variable that affects the runtime linker.
It allows you to put a dynamic object, that will create some sort<br>
of a buffer layer, between the application references and the
dependencies. It also grants you the possibility of linking with the<br>   application and relocating symbols/references.<br>  <br>   To simplify the situation. This is a man-in-the middle attack between the program and the needed libraries ;)<br>  <br>  Limitations<br>  -----------<br>  <br>
The LD_PRELOAD option does not effect applications that have been
chmod'ed with +s (setgid/setuid) flag. Unless the user that runs<br>
the program already has a root privileges. Also on some platforms, to
be able to use the LD_PRELOAD option the user should already <br>   have root privileges. All the examples brought up in this paper assume that you will use your own machine as a part of your <br>   reverse engineering framework. But it would work regardless, if you have root privileges elsewhere.<br>  <br>  Hack in a box<br>  -------------<br>   <br>
The simplest thing that LD_PRELOAD allows is to hijack a function. In
order to do it, we will create a shared library that will include<br>   the implementation of the function that we wish to hijack. But first let's take a look at our challenge:<br>  <br>   -- snip snip --<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>        </span><span style="color: rgb(255, 128, 0);">/*<br>         * strcmp-target.c, A simple challenge that compares two strings<br>         */<br><br>        #include &lt;stdio.h&gt;<br>        #include &lt;string.h&gt;<br><br>        </span><span style="color: rgb(0, 0, 187);">int main</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">int argc</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">**</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">) {<br>            </span><span style="color: rgb(0, 0, 187);">char passwd</span><span style="color: rgb(0, 119, 0);">[] = </span><span style="color: rgb(221, 0, 0);">"foobar"</span><span style="color: rgb(0, 119, 0);">;<br><br>            if (</span><span style="color: rgb(0, 0, 187);">argc </span><span style="color: rgb(0, 119, 0);">&lt; </span><span style="color: rgb(0, 0, 187);">2</span><span style="color: rgb(0, 119, 0);">) {<br>                </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"usage: %s &lt;given-password&gt;\n"</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">]);<br>                return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>            }<br><br>            if (!</span><span style="color: rgb(0, 0, 187);">strcmp</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">passwd</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">])) {<br>                </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"Green light!\n"</span><span style="color: rgb(0, 119, 0);">);<br>                return </span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">;<br>            }<br><br>            </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"Red light!\n"</span><span style="color: rgb(0, 119, 0);">);<br>            return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>        }<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code><br>   -- snip snip --<br>  <br>   In this example we got a simple password-matching challenge. It uses the strcmp() function for comparing the two strings.<br>
Lets attack it by hijacking the strcmp() function to see who's running
against who and to ensure it always returns equal strings!<br>  <br>   -- snip snip --<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>        </span><span style="color: rgb(255, 128, 0);">#include &lt;stdio.h&gt;<br>        #include &lt;string.h&gt;<br><br>        /*<br>         * strcmp-hijack.c, Hijack strcmp() function<br>         */<br><br>        /*<br>         * strcmp, Fixed strcmp function -- Always equal!<br>         */<br><br>        </span><span style="color: rgb(0, 0, 187);">int strcmp</span><span style="color: rgb(0, 119, 0);">(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">s1</span><span style="color: rgb(0, 119, 0);">, const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">s2</span><span style="color: rgb(0, 119, 0);">) {<br><br>            </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"S1 eq %s\n"</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">s1</span><span style="color: rgb(0, 119, 0);">);<br>            </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"S2 eq %s\n"</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">s2</span><span style="color: rgb(0, 119, 0);">);<br>    <br>            </span><span style="color: rgb(255, 128, 0);">// ALWAYS RETURN EQUAL STRINGS!<br>            </span><span style="color: rgb(0, 119, 0);">return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>        }<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code><br>   -- snip snip --<br>  <br>   Now let's compile our strcmp-hijack.c snippet as a shared library, by doing this:<br>  <br>    root@magicbox:/tmp# gcc -fPIC -c strcmp-hijack.c -o strcmp-hijack.o<br>    root@magicbox:/tmp# gcc -shared -o strcmp-hijack.so strcmp-hijack.o<br>  <br>   Before attacking, let's see if our challenge does what we expect it to do, by doing this:<br>  <br>    root@magicbox:/tmp# ./strcmp-target redbull<br>    Red light!<br>    root@magicbox:/tmp#<br>  <br>   Now let's attack it using LD_PRELOAD, by doing this:<br>  <br>    root@magicbox:/tmp# LD_PRELOAD="./strcmp-hijack.so" ./strcmp-target redbull<br>    S1 eq foobar<br>    S2 eq redbull<br>    Green light!<br>    root@magicbox:/tmp#<br>   <br>   Our evil shared library has done its job. We hijacked the strcmp() function and made it return a fixed value. Also we put a<br>
debug print that shows what the two arguments are, that have been sent
to the function. Now we know what the real password is as well.<br>  <br>
Notice I am using bash shell. And LD_PRELOAD is an environment
variable, which means it is up to your shell to set this variable. If
you have<br> troubles to set it, you should refer to your shell man
page, in order to find out how setting environment variable can be done.<br>  <br>  Gatekeeper<br>  ----------<br>  <br>
Hijacking functions is fun. But becoming a wrapper to a function is
more powerful. As a wrapper function we will accept the arguments<br>
that have been sent to the original function, pass 'em along to the
original function and examine the result. Then we could decide if<br>
we want to return the original value, or fix the return value. Calling
the original function would be done by using a pointer to the original<br>   function address. We will then use the runtime linker api, thus the dl*() function family.<br>  <br>   This is our new challenge, which is a little bit more complex:<br>  <br>   -- snip snip --<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>        </span><span style="color: rgb(255, 128, 0);">/*<br>         * crypt-mix.c, Don't let crypt() get cought up in your mix!<br>         */<br><br>        #include &lt;stdio.h&gt;<br>                #include &lt;unistd.h&gt;<br>            #include &lt;sys/types.h&gt;<br>        #include &lt;sys/stat.h&gt;<br>        #include &lt;fcntl.h&gt;<br>        #include &lt;string.h&gt;<br><br>                </span><span style="color: rgb(0, 0, 187);">int main</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">int argc</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">**</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">) {<br><br>                        </span><span style="color: rgb(0, 0, 187);">char buf</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">256</span><span style="color: rgb(0, 119, 0);">], </span><span style="color: rgb(0, 0, 187);">alpha</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">34</span><span style="color: rgb(0, 119, 0);">], </span><span style="color: rgb(0, 0, 187);">beta</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">34</span><span style="color: rgb(0, 119, 0);">];<br>                        </span><span style="color: rgb(0, 0, 187);">int j</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">plen</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">fd</span><span style="color: rgb(0, 119, 0);">;<br><br>                        if (</span><span style="color: rgb(0, 0, 187);">argc </span><span style="color: rgb(0, 119, 0);">&lt; </span><span style="color: rgb(0, 0, 187);">2</span><span style="color: rgb(0, 119, 0);">) {<br>                                </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"usage: %s &lt;keyfile&gt;\n"</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">]);<br>                                return </span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">;<br>                        }<br><br>            if (</span><span style="color: rgb(0, 0, 187);">strlen</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">]) &gt; </span><span style="color: rgb(0, 0, 187);">256</span><span style="color: rgb(0, 119, 0);">) {<br>                </span><span style="color: rgb(0, 0, 187);">fprintf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">stderr</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(221, 0, 0);">"keyfile length is &gt; 256, go fish!\n"</span><span style="color: rgb(0, 119, 0);">);<br>                return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>            }<br><br>                        </span><span style="color: rgb(0, 0, 187);">fd </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">open</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">], </span><span style="color: rgb(0, 0, 187);">O_RDONLY</span><span style="color: rgb(0, 119, 0);">);<br><br>            if (</span><span style="color: rgb(0, 0, 187);">fd </span><span style="color: rgb(0, 119, 0);">&lt; </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">) {<br>                </span><span style="color: rgb(0, 0, 187);">perror</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">]);<br>                return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>            }<br><br>                        </span><span style="color: rgb(0, 0, 187);">memset</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">buf</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">0x0</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">sizeof</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">buf</span><span style="color: rgb(0, 119, 0);">));<br><br>                        </span><span style="color: rgb(0, 0, 187);">plen </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">read</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">fd</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">buf</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">strlen</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">]));<br><br>                        if (</span><span style="color: rgb(0, 0, 187);">plen </span><span style="color: rgb(0, 119, 0);">!= </span><span style="color: rgb(0, 0, 187);">strlen</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">])) {<br><br>                                if (</span><span style="color: rgb(0, 0, 187);">plen </span><span style="color: rgb(0, 119, 0);">&lt; </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">) {<br>                                        </span><span style="color: rgb(0, 0, 187);">perror</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">]);<br>                                }<br><br>                </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"Sorry!\n"</span><span style="color: rgb(0, 119, 0);">);<br>                                return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>                        }<br><br>                        </span><span style="color: rgb(0, 0, 187);">strncpy</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">alpha</span><span style="color: rgb(0, 119, 0);">, (</span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*)</span><span style="color: rgb(0, 0, 187);">crypt</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">], </span><span style="color: rgb(221, 0, 0);">"$1$"</span><span style="color: rgb(0, 119, 0);">), </span><span style="color: rgb(0, 0, 187);">sizeof</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">alpha</span><span style="color: rgb(0, 119, 0);">));<br>                        </span><span style="color: rgb(0, 0, 187);">strncpy</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">beta</span><span style="color: rgb(0, 119, 0);">, (</span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*) </span><span style="color: rgb(0, 0, 187);">crypt</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">buf</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(221, 0, 0);">"$1$"</span><span style="color: rgb(0, 119, 0);">), </span><span style="color: rgb(0, 0, 187);">sizeof</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">beta</span><span style="color: rgb(0, 119, 0);">));<br><br>                        for (</span><span style="color: rgb(0, 0, 187);">j </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">; </span><span style="color: rgb(0, 0, 187);">j </span><span style="color: rgb(0, 119, 0);">&lt; </span><span style="color: rgb(0, 0, 187);">strlen</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">alpha</span><span style="color: rgb(0, 119, 0);">); </span><span style="color: rgb(0, 0, 187);">j</span><span style="color: rgb(0, 119, 0);">++) {<br><br>                                if (</span><span style="color: rgb(0, 0, 187);">alpha</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">j</span><span style="color: rgb(0, 119, 0);">] != </span><span style="color: rgb(0, 0, 187);">beta</span><span style="color: rgb(0, 119, 0);">[</span><span style="color: rgb(0, 0, 187);">j</span><span style="color: rgb(0, 119, 0);">]) {<br><br>                    </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"Sorry!\n"</span><span style="color: rgb(0, 119, 0);">);<br>                                        return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>                                }<br>                        }<br><br>                        </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"All your base are belong to us!\n"</span><span style="color: rgb(0, 119, 0);">);<br><br>                        return </span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">;<br>                }<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code><br>   -- snip snip --<br>  <br> This challenge principle is
quite simple. It performs a MD5 hash on the given filename then buffers
up the same amount of bytes <br> as the filename length itself, and
performs the same MD5 function on the payload. Then it compares the
two, without explicitly<br> using the strcmp() function. This forces us
to find a weak spot. This challenge's weak spot is the crypt() function
which can <br> be hijacked. The plan is to buffer up the 1st hash
returned by the 1st crypt() call, then fix up the 2nd crypt() return
value so <br>   it will match the 1st hash, and pass the comparing part smoothly.<br>  <br>   This is our new evil shared library:<br>  <br>   -- snip snip --<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>        </span><span style="color: rgb(255, 128, 0);">#define _GNU_SOURCE<br>        #include &lt;stdio.h&gt;<br>        #include &lt;dlfcn.h&gt;<br><br>        /*<br>         * crypt-mixup.c, Buffer up crypt() result to return later on.<br>         */<br><br>        // Pointer to the original crypt() call<br>        </span><span style="color: rgb(0, 119, 0);">static </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*(*</span><span style="color: rgb(0, 0, 187);">_crypt</span><span style="color: rgb(0, 119, 0);">)(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">key</span><span style="color: rgb(0, 119, 0);">, const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">salt</span><span style="color: rgb(0, 119, 0);">) = </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">;<br><br>        </span><span style="color: rgb(255, 128, 0);">// Pointer to crypt() previous result<br>        </span><span style="color: rgb(0, 119, 0);">static </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">crypt_res </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">;<br><br>        </span><span style="color: rgb(255, 128, 0);">/*<br>         * crypt, Crooked crypt function<br>         */<br><br>               </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">crypt</span><span style="color: rgb(0, 119, 0);">(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">key</span><span style="color: rgb(0, 119, 0);">, const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">salt</span><span style="color: rgb(0, 119, 0);">) {<br><br>            </span><span style="color: rgb(255, 128, 0);">// Initialize of _crypt(), if needed.<br>            </span><span style="color: rgb(0, 119, 0);">if (</span><span style="color: rgb(0, 0, 187);">_crypt </span><span style="color: rgb(0, 119, 0);">== </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">) {<br>                </span><span style="color: rgb(0, 0, 187);">_crypt </span><span style="color: rgb(0, 119, 0);">= (</span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*(*)(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">key</span><span style="color: rgb(0, 119, 0);">, const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">salt</span><span style="color: rgb(0, 119, 0);">)) </span><span style="color: rgb(0, 0, 187);">dlsym</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">RTLD_NEXT</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(221, 0, 0);">"crypt"</span><span style="color: rgb(0, 119, 0);">);<br>                </span><span style="color: rgb(0, 0, 187);">crypt_res </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">;<br>            }<br><br>            </span><span style="color: rgb(255, 128, 0);">// No previous result, continue as normal crypt()<br>            </span><span style="color: rgb(0, 119, 0);">if (</span><span style="color: rgb(0, 0, 187);">crypt_res </span><span style="color: rgb(0, 119, 0);">== </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">) {<br>                </span><span style="color: rgb(0, 0, 187);">crypt_res </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">_crypt</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">key</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">salt</span><span style="color: rgb(0, 119, 0);">);<br>                return </span><span style="color: rgb(0, 0, 187);">crypt_res</span><span style="color: rgb(0, 119, 0);">;<br>            }<br>        <br>            </span><span style="color: rgb(255, 128, 0);">// We already got result buffered up!<br>            </span><span style="color: rgb(0, 0, 187);">_crypt </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">;<br>            return </span><span style="color: rgb(0, 0, 187);">crypt_res</span><span style="color: rgb(0, 119, 0);">;<br>        }<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code> <br>   -- snip snip --<br>  <br>   We will start by simply testing the challenge, doing this:<br>  <br>    root@magicbox:/tmp# gcc -o crypt-mix crypt-mix.c -lcrypt<br>    root@magicbox:/tmp# echo "foobar" &gt; mykey<br>    root@magicbox:/tmp# ./crypt-mix mykey<br>    Sorry!<br>  <br>   Now let's try it again with our evil shared library, by doing this:<br>  <br>    root@magicbox:/tmp# gcc -fPIC -c -o crypt-mixup.o crypt-mixup.c<br>    root@magicbox:/tmp# gcc -shared -o crypt-mixup.so crypt-mixup.o -ldl<br>    root@magicbox:/tmp# LD_PRELOAD="./crypt-mixup.so" ./crypt-mix mykey<br>    All your base are belong to us!<br>  <br>   Again using LD_PRELOAD, we just bypassed the mechanism and went straight on.<br>  <br>  Cerberus<br>  --------<br>  <br>
After we did a few high level tricks. It is time to get our hands a
little dirty. And this means involving Assembly in the mix.<br>   The next challenge might look a little bit odd, check it out:<br>  <br>   -- snip snip --<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>        </span><span style="color: rgb(255, 128, 0);">/*<br>         * cerberus.c, Impossible statement <br>         */<br><br>        #include &lt;stdio.h&gt;<br><br>        </span><span style="color: rgb(0, 0, 187);">int main</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">int argc</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">**</span><span style="color: rgb(0, 0, 187);">argv</span><span style="color: rgb(0, 119, 0);">) {<br>            </span><span style="color: rgb(0, 0, 187);">int a </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">13</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(0, 0, 187);">b </span><span style="color: rgb(0, 119, 0);">= </span><span style="color: rgb(0, 0, 187);">17</span><span style="color: rgb(0, 119, 0);">;<br><br>            if (</span><span style="color: rgb(0, 0, 187);">a </span><span style="color: rgb(0, 119, 0);">!= </span><span style="color: rgb(0, 0, 187);">b</span><span style="color: rgb(0, 119, 0);">) {<br>                </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"Sorry!\n"</span><span style="color: rgb(0, 119, 0);">);<br>                return </span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">;<br>            }<br><br>            </span><span style="color: rgb(0, 0, 187);">printf</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(221, 0, 0);">"On a long enough timeline, the survival rate for everyone drops to zero\n"</span><span style="color: rgb(0, 119, 0);">);<br>            exit(</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">);<br>        }<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code><br>   -- snip snip --<br>   <br> As you can see in this
challenge our input doesn't count. The statement will always be
incorrect. Regardless of any parameters that<br>   will be passed to main(). But there is a way out! <br>  <br>   To understand this trick, let's first disassemble the main function, following this:<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>        </span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">gdb</span><span style="color: rgb(0, 119, 0);">) </span><span style="color: rgb(0, 0, 187);">disassemble main<br>        Dump of assembler code </span><span style="color: rgb(0, 119, 0);">for function </span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">:<br>        </span><span style="color: rgb(0, 0, 187);">0x080483c4 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">0</span><span style="color: rgb(0, 119, 0);">&gt;:    </span><span style="color: rgb(0, 0, 187);">push   </span><span style="color: rgb(0, 119, 0);">%</span><span style="color: rgb(0, 0, 187);">ebp<br>        0x080483c5 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">&gt;:    </span><span style="color: rgb(0, 0, 187);">mov    </span><span style="color: rgb(0, 119, 0);">%</span><span style="color: rgb(0, 0, 187);">esp</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">ebp<br>        0x080483c7 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">3</span><span style="color: rgb(0, 119, 0);">&gt;:    </span><span style="color: rgb(0, 0, 187);">sub    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x18</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x080483ca </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">6</span><span style="color: rgb(0, 119, 0);">&gt;:    and    $</span><span style="color: rgb(0, 0, 187);">0xfffffff0</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x080483cd </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">9</span><span style="color: rgb(0, 119, 0);">&gt;:    </span><span style="color: rgb(0, 0, 187);">mov    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x0</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">eax<br>        0x080483d2 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">14</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">sub    </span><span style="color: rgb(0, 119, 0);">%</span><span style="color: rgb(0, 0, 187);">eax</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x080483d4 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">16</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">movl   </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0xd</span><span style="color: rgb(0, 119, 0);">,</span><span style="color: rgb(0, 0, 187);">0xfffffffc</span><span style="color: rgb(0, 119, 0);">(%</span><span style="color: rgb(0, 0, 187);">ebp</span><span style="color: rgb(0, 119, 0);">)<br>        </span><span style="color: rgb(0, 0, 187);">0x080483db </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">23</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">movl   </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x11</span><span style="color: rgb(0, 119, 0);">,</span><span style="color: rgb(0, 0, 187);">0xfffffff8</span><span style="color: rgb(0, 119, 0);">(%</span><span style="color: rgb(0, 0, 187);">ebp</span><span style="color: rgb(0, 119, 0);">)<br>        </span><span style="color: rgb(0, 0, 187);">0x080483e2 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">30</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">mov    0xfffffffc</span><span style="color: rgb(0, 119, 0);">(%</span><span style="color: rgb(0, 0, 187);">ebp</span><span style="color: rgb(0, 119, 0);">),%</span><span style="color: rgb(0, 0, 187);">eax<br>        0x080483e5 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">33</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">cmp    0xfffffff8</span><span style="color: rgb(0, 119, 0);">(%</span><span style="color: rgb(0, 0, 187);">ebp</span><span style="color: rgb(0, 119, 0);">),%</span><span style="color: rgb(0, 0, 187);">eax<br>        0x080483e8 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">36</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">je     0x8048403 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">63</span><span style="color: rgb(0, 119, 0);">&gt;<br>        </span><span style="color: rgb(0, 0, 187);">0x080483ea </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">38</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">sub    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0xc</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x080483ed </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">41</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">push   </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x8048560<br>        0x080483f2 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">46</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">call   0x80482d4 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">_init</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">56</span><span style="color: rgb(0, 119, 0);">&gt;<br>        </span><span style="color: rgb(0, 0, 187);">0x080483f7 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">51</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">add    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x10</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x080483fa </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">54</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">movl   </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x0</span><span style="color: rgb(0, 119, 0);">,</span><span style="color: rgb(0, 0, 187);">0xfffffff4</span><span style="color: rgb(0, 119, 0);">(%</span><span style="color: rgb(0, 0, 187);">ebp</span><span style="color: rgb(0, 119, 0);">)<br>        </span><span style="color: rgb(0, 0, 187);">0x08048401 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">61</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">jmp    0x804841d </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">89</span><span style="color: rgb(0, 119, 0);">&gt;<br>        </span><span style="color: rgb(0, 0, 187);">0x08048403 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">63</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">sub    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0xc</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x08048406 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">66</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">push   </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x8048580<br>        0x0804840b </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">71</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">call   0x80482d4 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">_init</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">56</span><span style="color: rgb(0, 119, 0);">&gt;<br>        </span><span style="color: rgb(0, 0, 187);">0x08048410 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">76</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">add    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x10</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x08048413 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">79</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">sub    </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0xc</span><span style="color: rgb(0, 119, 0);">,%</span><span style="color: rgb(0, 0, 187);">esp<br>        0x08048416 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">82</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">push   </span><span style="color: rgb(0, 119, 0);">$</span><span style="color: rgb(0, 0, 187);">0x0<br>        0x08048418 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">84</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">call   0x80482e4 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">_init</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">72</span><span style="color: rgb(0, 119, 0);">&gt;<br>        </span><span style="color: rgb(0, 0, 187);">0x0804841d </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">89</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">mov    0xfffffff4</span><span style="color: rgb(0, 119, 0);">(%</span><span style="color: rgb(0, 0, 187);">ebp</span><span style="color: rgb(0, 119, 0);">),%</span><span style="color: rgb(0, 0, 187);">eax<br>        0x08048420 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">92</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">leave<br>        0x08048421 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">93</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">ret<br>        0x08048422 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">94</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048423 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">95</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048424 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">96</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048425 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">97</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048426 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">98</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048427 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">99</span><span style="color: rgb(0, 119, 0);">&gt;:   </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048428 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">100</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x08048429 </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">101</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x0804842a </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">102</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x0804842b </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">103</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x0804842c </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">104</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x0804842d </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">105</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x0804842e </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">106</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        0x0804842f </span><span style="color: rgb(0, 119, 0);">&lt;</span><span style="color: rgb(0, 0, 187);">main</span><span style="color: rgb(0, 119, 0);">+</span><span style="color: rgb(0, 0, 187);">107</span><span style="color: rgb(0, 119, 0);">&gt;:  </span><span style="color: rgb(0, 0, 187);">nop<br>        End of assembler dump</span><span style="color: rgb(0, 119, 0);">.<br>        (</span><span style="color: rgb(0, 0, 187);">gdb</span><span style="color: rgb(0, 119, 0);">)<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code> <br>   The IF statement takes place in , the 'je' is not evaluated. Therefore we do not jump to  but rather continue <br>
to . There it pushes the string into the stack and calls printf() --
Hold on! Are you thinking what I'm thinking? *RET HIJACK* ;-)<br>   <br>   -- snip snip --<br>  <code><span style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 187);"><br>                </span><span style="color: rgb(255, 128, 0);">#define _GNU_SOURCE<br>                #include &lt;stdio.h&gt;<br>                #include &lt;dlfcn.h&gt;<br>                #include &lt;stdarg.h&gt;<br><br>                /*<br>                 * megatron.c, Making the impossible possible!<br>                 */<br><br>                // Pointer to the original printf() call<br>                </span><span style="color: rgb(0, 119, 0);">static </span><span style="color: rgb(0, 0, 187);">int </span><span style="color: rgb(0, 119, 0);">(*</span><span style="color: rgb(0, 0, 187);">_printf</span><span style="color: rgb(0, 119, 0);">)(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">format</span><span style="color: rgb(0, 119, 0);">, ...) = </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">;<br><br>                </span><span style="color: rgb(255, 128, 0);">/*<br>                 * printf, One nasty function!<br>                 */<br><br>                </span><span style="color: rgb(0, 0, 187);">int printf</span><span style="color: rgb(0, 119, 0);">(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">format</span><span style="color: rgb(0, 119, 0);">, ...) {<br><br>                        if (</span><span style="color: rgb(0, 0, 187);">_printf </span><span style="color: rgb(0, 119, 0);">== </span><span style="color: rgb(0, 0, 187);">NULL</span><span style="color: rgb(0, 119, 0);">) {<br>                                </span><span style="color: rgb(0, 0, 187);">_printf </span><span style="color: rgb(0, 119, 0);">= (</span><span style="color: rgb(0, 0, 187);">int </span><span style="color: rgb(0, 119, 0);">(*)(const </span><span style="color: rgb(0, 0, 187);">char </span><span style="color: rgb(0, 119, 0);">*</span><span style="color: rgb(0, 0, 187);">format</span><span style="color: rgb(0, 119, 0);">, ...)) </span><span style="color: rgb(0, 0, 187);">dlsym</span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">RTLD_NEXT</span><span style="color: rgb(0, 119, 0);">, </span><span style="color: rgb(221, 0, 0);">"printf"</span><span style="color: rgb(0, 119, 0);">);<br><br>                                </span><span style="color: rgb(255, 128, 0);">// Hijack the RET address and modify it to &lt;main+66&gt;<br>                                </span><span style="color: rgb(0, 0, 187);">__asm__ __volatile__ </span><span style="color: rgb(0, 119, 0);">(<br>                                        </span><span style="color: rgb(221, 0, 0);">"movl 0x4(%ebp), %eax \n"<br>                                        "addl $15, %eax \n"<br>                                        "movl %eax, 0x4(%ebp)"<br>                                </span><span style="color: rgb(0, 119, 0);">);<br><br>                                return </span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">;<br>                        }<br><br>                        </span><span style="color: rgb(255, 128, 0);">// Rewind ESP and JMP into _PRINTF()<br>                        </span><span style="color: rgb(0, 0, 187);">__asm__ __volatile__ </span><span style="color: rgb(0, 119, 0);">(<br>                                </span><span style="color: rgb(221, 0, 0);">"addl $12, %%esp \n"<br>                                "jmp *%0 \n"<br>                                </span><span style="color: rgb(0, 119, 0);">: </span><span style="color: rgb(255, 128, 0);">/* no output registers */<br>                                </span><span style="color: rgb(0, 119, 0);">: </span><span style="color: rgb(221, 0, 0);">"g" </span><span style="color: rgb(0, 119, 0);">(</span><span style="color: rgb(0, 0, 187);">_printf</span><span style="color: rgb(0, 119, 0);">)<br>                                : </span><span style="color: rgb(221, 0, 0);">"%esp"<br>                                </span><span style="color: rgb(0, 119, 0);">);<br><br>                        </span><span style="color: rgb(255, 128, 0);">/* NEVER REACH */<br>                        </span><span style="color: rgb(0, 119, 0);">return -</span><span style="color: rgb(0, 0, 187);">1</span><span style="color: rgb(0, 119, 0);">;<br>                }<br></span><span style="color: rgb(0, 0, 187);"></span>
</span>
</code><br>   -- snip snip --<br>   <br>   As always before attacking, we test the challenge, by doing this:<br>  <br>    root@magicbox:/tmp# ./cerberus<br>    Sorry!<br>   <br>   It is a pretty straight forward challenge. Now let's attack this challenge using our evil shared library, doing this:<br>  <br>    root@magicbox:/tmp# gcc -fPIC -o megatron.o megatron.c -c<br>    root@magicbox:/tmp# gcc -shared -o megatron.so megatron.o -ldl<br>    root@magicbox:/tmp# LD_PRELOAD="./megatron.so" ./cerberus<br>    On a long enough timeline, the survival rate for everyone drops to zero<br>   <br>
Our attack succeeds. Manipulating the printf() function return address
has made the impossible possible. I will not get into details <br>
about this attack. As it alone deserved a paper about it. I would say
that I've cheated a little bit, as this code has created a stack
corruption, <br> and I have used the exit() function to do the some
dirty work for me. Notice that the printf() family functions are
unusual in the way they<br> meant to accept unlimited number of
parameters. The code above is meant to be a proof of concept to how it
is possible to manipulate the <br>   program flow dynamically. <br>  <br>
To conclude this paper I would say that LD_PRELOAD is a powerful
feature, and can be used on many purposes and Reverse Engineering is
only one.<br>  <br>  Contact<br>  -------<br>  <br>   Izik  [or]  <a href="http://neworder.box.sk/redirect.php?http://www.tty64.org" target="_blank">http://www.tty64.org</a> <br>  </span><p class="edgemenu"></p><p class="edgemenu"><a href="http://neworder.box.sk/forum.php?did=edge13857">read comments</a> (3) /
		<a href="http://neworder.box.sk/forum.newtopic.php?did=edge13857">write comment</a></p><span class="edgemenu">views: 23125   <a href="http://neworder.box.sk/print/13857">printer-friendly version</a></span></td></tr></tbody></table></td></tr></tbody></table></font><p class="edgesmall"></p><p align="right"><font size="-1" face="arial,helvetica"><a href="#top">Top of page</a></font></p>
<font size="-1" face="arial,helvetica">  </font></td>
	
   </tr>
 </tbody></table>
</div>
<div id="footer">
<!-- BOTTOM BANNER -->
<!-- END --><p>

	<a href="http://edge.dev.box.sk/">powered by<br><img src="hijack%20Files/edge1munkt0n.jpg" border="0"></a><br> 
	The content, logo and design of this site is © 2008 by particular authors, 
	the New Order team and <a href="http://www.boxnetwork.net/">Box Network ltd</a>.<br> 
	For more information about New Order contact <a href="mailto:Marek@boxnetwork.net">Marek</a><br>
	The <a href="http://www.boxnetwork.net/docs/privacy.html"> privacy policy</a> statement for 
	<a href="http://www.boxnetwork.net/">Box Network</a>.
</p><center>
<p>
</p></center>

</div>
<!--running time: 0.0825350284576 seconds---><!--boddy time: 0.0560920238495 seconds---><!--header/footer time: 0.0264430046082 seconds--->
<script src="hijack%20Files/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-3401039-7";
urchinTracker();
</script>

</body></html>